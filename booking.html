<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ご予約 - WEST FIELD</title>
	<!-- Tailwind CSS CDN with custom config -->
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						'primary': '#56BAB6',
						'secondary': '#2C3E50',
					},
					fontFamily: {
						'sans': ['"Hiragino Sans"', '"Hiragino Kaku Gothic ProN"', '"Yu Gothic"', 'Meiryo', 'sans-serif'],
					},
					screens: {
						'xs': '480px',
						'lg': '1080px',
					},
					maxWidth: {
						'large-12': '1080px',
					},
					animation: {
						'slide-in': 'slideIn 0.3s ease-in-out',
						'slide-out': 'slideOut 0.3s ease-in-out',
					},
					keyframes: {
						slideIn: {
							'0%': { transform: 'translateX(-100%)' },
							'100%': { transform: 'translateX(0)' },
						},
						slideOut: {
							'0%': { transform: 'translateX(0)' },
							'100%': { transform: 'translateX(-100%)' },
						},
					},
				},
			},
		}
	</script>
	<!-- Font Awesome for icons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<!-- Custom CSS -->
	<link rel="stylesheet" href="assets/css/style.css">
	<!-- Favicon -->
	<link rel="icon" type="image/x-icon" href="assets/img/logo.jpg">
</head>

<body class="font-sans">
	<!-- Header -->
	<div id="header"></div>

	<!-- Main Content -->
	<main class="pt-0 min-h-screen">
		<!-- メインカラム（1080px内側が白背景、外側は背景画像） -->
		<div class="max-w-large-12 mx-auto w-full px-4 py-12 bg-white mt-[65px]">
			<!-- 1. 中央にロゴマーク 173x173px -->
			<div class="flex justify-center mb-6">
				<img src="assets/img/logo.jpg" alt="WEST FIELD ロゴ"
					class="md:w-[173px] md:h-[173px] w-[140px] h-[140px] object-contain">
			</div>

			<!-- 2. ロゴの下にテキスト -->
			<div class="text-center mb-12">
				<h1 class="md:text-4xl text-3xl font-bold text-gray-800 mb-2">ご予約</h1>
				<p class="md:text-xl text-lg text-gray-600">WEST FIELD ご予約フォーム</p>
			</div>

			<!-- ここにご予約フォーム -->
			<section class="max-w-5xl mx-auto">
				<h2 class="text-2xl font-bold text-gray-800">定例会・貸切・夜戦予約</h2>
				<hr class="mt-4 mb-10 border-gray-200">

				<form action="booking_submit.php" method="post" class="space-y-8">
					<!-- CSRFトークン -->
					<input type="hidden" name="csrf_token" id="csrf_token" value="">

					<!-- ページ表示時刻（セッション用） -->
					<input type="hidden" name="page_load_time" id="page_load_time" value="">

					<!-- ハニーポット（スパムボット対策） -->
					<div style="display: none;">
						<label for="website">ウェブサイト</label>
						<input type="text" id="website" name="website" tabindex="-1" autocomplete="off">
					</div>

					<!-- 予約種別 -->
					<div>
						<label for="booking_type" class="block text-sm font-bold text-gray-700 mb-2">予約種別</label>
						<select id="booking_type" name="booking_type"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary"
							required>
							<option value="normal" selected>通常予約（定例会）</option>
							<option value="rental">貸切予約</option>
							<option value="night_battle">夜戦予約</option>
						</select>
					</div>

					<!-- 氏名（漢字） -->
					<div>
						<label for="name_kanji" class="block text-sm font-bold text-gray-700 mb-2">氏名（漢字）</label>
						<input id="name_kanji" name="name_kanji" type="text" autocomplete="name"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary"
							required />
					</div>

					<!-- 氏名（ひらがな） -->
					<div>
						<label for="name_kana" class="block text-sm font-bold text-gray-700 mb-2">氏名（ひらがな）</label>
						<input id="name_kana" name="name_kana" type="text" autocomplete="off"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary"
							required />
					</div>

					<!-- メールアドレス（半角英数） -->
					<div>
						<label for="email" class="block text-sm font-bold text-gray-700 mb-2">メールアドレス（半角英数）</label>
						<input id="email" name="email" type="email" autocomplete="email" inputmode="email"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary"
							required />
					</div>

					<!-- ご住所 -->
					<div>
						<label for="address" class="block text-sm font-bold text-gray-700 mb-2">ご住所</label>
						<input id="address" name="address" type="text" autocomplete="street-address"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary" />
					</div>

					<!-- 電話番号（半角英数） -->
					<div>
						<label for="tel" class="block text-sm font-bold text-gray-700 mb-2">電話番号（半角英数）</label>
						<input id="tel" name="tel" type="tel" autocomplete="tel" inputmode="tel"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary" />
					</div>

					<!-- 参加日 -->
					<div>
						<label for="event_date" class="block text-sm font-bold text-gray-700 mb-2">参加日<span
								class="font-normal">※右端のカレンダーアイコンをクリックすると便利に入力出来ます。</span></label>
						<input id="event_date" name="event_date" type="date"
							class="w-full border border-gray-300 h-12 px-4 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"
							required />
					</div>

					<!-- チーム名 -->
					<div>
						<label for="team_name" class="block text-sm font-bold text-gray-700 mb-2">チーム名<span
								class="font-normal">（Twitterアカウントを記載して良いはアカウント名も）</span></label>
						<input id="team_name" name="team_name" type="text"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary" />
					</div>

					<!-- ご利用人数 -->
					<div>
						<label for="people" class="block text-sm font-bold text-gray-700 mb-2">ご利用人数（半角数字）</label>
						<input id="people" name="people" type="number" min="1" step="1" inputmode="numeric"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary"
							required />
					</div>

					<!-- 参加者 -->
					<div>
						<label for="participants" class="block text-sm font-bold text-gray-700 mb-2">参加者<span
								class="font-normal">※代表者の氏名をご記入下さい。</span></label>
						<input id="participants" name="participants" type="text"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary" />
					</div>

					<!-- 送迎 -->
					<div>
						<label for="pickup" class="block text-sm font-bold text-gray-700 mb-2">河内長野駅からの送迎</label>
						<select id="pickup" name="pickup"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary">
							<option value="" selected>—Please choose an option—</option>
							<option value="yes">有り</option>
							<option value="no">無し</option>
						</select>
					</div>

					<!-- 送迎人数 -->
					<div>
						<p class="text-sm font-bold text-gray-700 mb-2">送迎を「有り」にした方は人数の記載もお願いいたします。<span
								class="font-normal">※記載がない場合対応ができかねることもございますのでご注意下さい。</span></p>
						<input id="pickup_people" name="pickup_people" type="text" placeholder="例：5人など"
							class="w-full border border-gray-300 h-12 px-4 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary" />
					</div>

					<!-- レンタル品（電動ガン） -->
					<div>
						<label for="rental_gun" class="block text-sm font-bold text-gray-700 mb-2">レンタル品（電動ガン）</label>
						<input id="rental_gun" name="rental_gun" type="text"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary" />
					</div>

					<!-- レンタル品（ゴーグル） -->
					<div>
						<label for="rental_goggle"
							class="block text-sm font-bold text-gray-700 mb-2">レンタル品（ゴーグル）</label>
						<input id="rental_goggle" name="rental_goggle" type="text"
							class="w-full border border-gray-300 h-12 px-4 bg-white focus:outline-none focus:ring-2 focus:ring-primary" />
					</div>

					<!-- 送信 -->
					<div class="pt-2">
						<button type="submit"
							class="inline-flex items-center justify-center px-8 h-10 bg-primary text-white font-bold hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-primary">送信</button>
					</div>
				</form>
			</section>
		</div>
	</main>

	<!-- Footer -->
	<div id="footer"></div>

	<!-- JavaScript -->
	<script>
		fetch('header.html')
			.then(res => res.text())
			.then(data => {
				document.getElementById('header').innerHTML = data;
			});

		fetch('footer.html')
			.then(res => res.text())
			.then(data => {
				document.getElementById('footer').innerHTML = data;
			});

		// ページ読み込み時にCSRFトークンと表示時刻を設定
		document.addEventListener('DOMContentLoaded', function () {
			// ページ表示時刻を設定（Unixタイムスタンプ）
			const pageLoadTime = Math.floor(Date.now() / 1000);
			const loadTimeInput = document.getElementById('page_load_time');
			if (loadTimeInput) loadTimeInput.value = pageLoadTime;

			// CSRFトークンを取得
			fetch('get_csrf_token.php')
				.then(response => response.json())
				.then(data => {
					if (data.success && data.token) {
						const csrfInput = document.getElementById('csrf_token');
						if (csrfInput) csrfInput.value = data.token;
					}
				})
				.catch(error => {
					console.error('CSRFトークン取得エラー:', error);
				});

			// フォーム送信イベントを設定
			const form = document.querySelector('form');
			if (form) form.addEventListener('submit', handleFormSubmit);
		});

		// フォーム送信処理
		async function handleFormSubmit(event) {
			event.preventDefault();

			const form = event.target;
			const submitButton = form.querySelector('button[type="submit"]');
			const originalButtonText = submitButton.textContent;

			// ボタンを無効化
			submitButton.disabled = true;
			submitButton.textContent = '送信中...';

			try {
				const formData = new FormData(form);

				const response = await fetch(form.action, {
					method: 'POST',
					body: formData
				});

				const result = await response.json();

				if (result.success) {
					// 成功メッセージを表示
					showMessage(result.message, 'success');
					// フォームをリセット
					form.reset();
					// CSRFトークンを再取得
					await refreshCsrfToken();
				} else {
					// エラーメッセージを表示
					showMessage(result.message, 'error');
				}
			} catch (error) {
				console.error('送信エラー:', error);
				showMessage('通信エラーが発生しました。もう一度お試しください。', 'error');
			} finally {
				// ボタンを元に戻す
				submitButton.disabled = false;
				submitButton.textContent = originalButtonText;
			}
		}

		// CSRFトークンを再取得
		async function refreshCsrfToken() {
			try {
				const response = await fetch('get_csrf_token.php');
				const data = await response.json();
				if (data.success && data.token) {
					const csrfInput = document.getElementById('csrf_token');
					if (csrfInput) csrfInput.value = data.token;
				}
			} catch (error) {
				console.error('CSRFトークン更新エラー:', error);
			}
		}

		// メッセージ表示関数
		function showMessage(message, type) {
			// 既存のメッセージを削除
			const existingMessage = document.querySelector('.form-message');
			if (existingMessage) {
				existingMessage.remove();
			}

			// 新しいメッセージを作成
			const messageDiv = document.createElement('div');
			messageDiv.className = `form-message p-4 mb-6 rounded-md ${type === 'success' ? 'bg-green-50 text-green-800 border border-green-200' : 'bg-red-50 text-red-800 border border-red-200'}`;
			messageDiv.textContent = message;

			// フォームの前に挿入
			const form = document.querySelector('form');
			if (form) form.parentNode.insertBefore(messageDiv, form);

			// メッセージまでスクロール
			messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

			// 成功メッセージは5秒後に自動的に消える
			if (type === 'success') {
				setTimeout(() => {
					if (messageDiv.parentNode) {
						messageDiv.remove();
					}
				}, 5000);
			}
		}
	</script>
	<script src="assets/js/main.js"></script>
</body>

</html>